<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hand Jump Game - PKS</title>
  <style>
    body{
      margin:0;
      overflow:hidden;
      background:#222;
      display:flex;
      justify-content:center;
      align-items:center;
      flex-direction:column;
      color:white;
      font-family:Arial;
    }
    canvas{
      background:#87CEEB;
      border:3px solid white;
    }
    video{
      position:absolute;
      right:10px;
      bottom:10px;
      width:200px;
      border:2px solid white;
    }
  </style>
</head>
<body>

<h2>ðŸ¤š Raise Your Finger Fast to Jump</h2>

<canvas id="gameCanvas" width="600" height="300"></canvas>
<video id="video" autoplay playsinline></video>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let player = {
  x:100,
  y:220,
  width:40,
  height:40,
  velocityY:0,
  gravity:0.8,
  jumping:false
};
let speed =3;
function drawPlayer(){
  ctx.fillStyle="red";
  ctx.fillRect(player.x, player.y, player.width, player.height);
}

function updatePlayer(){
  player.velocityY += player.gravity;
  player.y += player.velocityY;
  player.x+=speed;

  if(player.y > 220){
    player.y = 220;
    player.velocityY = 0;
    player.jumping = false;
  }
}

function jump(){
  if(!player.jumping){
    player.velocityY = -15;
    player.jumping = true;
  }
}

function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="green";
  ctx.fillRect(0,260,600,40);

  updatePlayer();
  drawPlayer();

  requestAnimationFrame(gameLoop);
}
gameLoop();


// ---------------- HAND TRACKING ----------------

const videoElement = document.getElementById('video');

const hands = new Hands({
  locateFile: (file) => {
    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
  }
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

let previousY = null;

hands.onResults(results => {
  if(results.multiHandLandmarks.length > 0){
    const landmarks = results.multiHandLandmarks[0];

    const indexFingerTip = landmarks[8];
    const currentY = indexFingerTip.y;

    if(previousY !== null){
      let diff = previousY - currentY;

      if(diff > 0.08){   // sensitivity control
        jump();
      }
    }

    previousY = currentY;
  }
});

const camera = new Camera(videoElement, {
  onFrame: async () => {
    await hands.send({image: videoElement});
  },
  width: 640,
  height: 480
});
camera.start();
</script>

</body>
</html>
